<p>최근 새로운 프로젝트를 시작하며 인증(Auth)과 관련된 API 연동을 하는데 인증 관련 API 연동을 한 경험이 다수 있음에도 불구하고 여전히 헷갈리는 개념들을 이번에~ 한큐에~ 정리해보고자 한다.</p>
<h1 id="쿠키-vs-토큰-애초에-비교부터-잘못되었음">쿠키 vs 토큰? 애초에 비교부터 잘못되었음..!</h1>
<p>인증을 공부하다 보면 &quot;쿠키 vs 토큰&quot; 이라는 표현을 자주 보게 된다.
하지만 이 둘은 서로 대체 관계가 아니라, <strong>역할이 완전히 다르다❗️</strong></p>
<p>쿠키(Cookie)는 <strong>저장 방식</strong>이고, 토큰은 <strong>저장되는 데이터의 한 종류</strong>다.
그래서 쿠키 자체를 토큰과 비교하는 것부터가 개념적으로 맞지 않는다. <del>맙소사</del>
<img alt="" src="https://velog.velcdn.com/images/dev-joohee/post/14ad7c51-beaa-4e6f-8fab-1d145193f219/image.png" /></p>
<h1 id="쿠키cookie란">쿠키(Cookie)란?</h1>
<p>쿠키는 <strong>서버가 브라우저에 저장하도록 지시할 수 있는 작은 데이터</strong>다.
쿠키의 목적은 간단하다.</p>
<blockquote>
<p>서버가 사용자를 기억하기 위함🧘</p>
</blockquote>
<h2 id="쿠키는-어떻게-동작할까">쿠키는 어떻게 동작할까?</h2>
<p>웹사이트에 처음 방문하면, 브라우저는 서버에 요청(Request)을 보낸다.
서버는 이에 대한 응답(Response)을 보내는데, 이 응답에는 다음과 같은 것들이 포함될 수 있다.</p>
<ul>
<li>HTML 페이지</li>
<li>JSON 데이터</li>
<li>브라우저에 저장하라고 지시하는 쿠키(Set-Cookie)
브라우저는 이 쿠키를 저장해 두었다가, 이후 <strong>같은 웹사이트에 다시 요청할 때마가 쿠키를 자동으로 함께 전송</strong>한다.</li>
</ul>
<p><img alt="" src="https://velog.velcdn.com/images/dev-joohee/post/67536226-72cd-407e-94dc-a5b79077b5be/image.png" /></p>
<p>즉, 서버는 매 요청마다 &quot;아, 이 사용자는 예전에 이런 정보를 가지고 있었구나&quot;라고 판단할 수 있게 된다!</p>
<h2 id="쿠키는-도메인-기준으로-동작한다">쿠키는 도메인 기준으로 동작한다</h2>
<p>쿠키는 <strong>도메인 단위로 제한</strong>된다.
예를 들어, <code>youtube.com</code>이 발급한 쿠키는 <strong>youtube.com으로 요청할 때만 전송</strong>된다.
다른 사이트에서는 해당 쿠키에 접근하거나 전송할 수 없다.</p>
<h2 id="쿠키는-유효기간이-있다">쿠키는 유효기간이 있다</h2>
<p>쿠키는 <strong>서버가 정한 유효기간(Expires/Max-Age)</strong>에 따라 유지된다.</p>
<ul>
<li>유효기간이 지나면 자동으로 삭제됨</li>
<li>세션 쿠키의 경우 브라우저 종료 시 삭제되기도 함</li>
</ul>
<h2 id="쿠키는-인증-외에도-사용된다">쿠키는 인증 외에도 사용된다</h2>
<p>쿠키는 <strong>인증 정보만 저장하는 용도가 아니다!</strong></p>
<p>예를 들어 <code>웹사이트 언어 설정</code>, <code>다크 모드 여부</code>, <code>사용자 UI 설정</code> 등에도 사용이 되는데 그 중 <code>웹사이트 언어 설정</code>의 경우, 사용자가 웹사이트에서 언어를 변경하면 서버는 해당 언어 정보를 쿠키에 저장해 둘 수 있다. 
이후 사용자가 다시 방문하면, 브라우저는 쿠키를 요청과 함께 보내고 서버는 쿠키에 저장된 언어 설정을 기반으로 <strong>해당 언어의 페이지를 제공</strong>한다👏</p>
<hr />
<p>그런데 쿠키를 이해하다 보면 자연스럽게 이런 의문이 생긴다.(실제로 내가 궁금했던 점들이다..)</p>
<ul>
<li>서버는 왜 사용자를 기억하지 못할까?</li>
<li>로그인 상태는 어떻게 유지되는 걸까?</li>
<li>세션과 토큰은 쿠키랑 뭐가 다른 걸까?</li>
</ul>
<p>이 질문에 답하기 위해서는 <strong>HTTP의 특성</strong>부터 다시 짚고 가야 한다.</p>
<hr />
<h1 id="http는-왜-사용자를-기억하지-못할까">HTTP는 왜 사용자를 기억하지 못할까?</h1>
<p>HTTP는 <strong>stateless(무상태)</strong> 프로토콜이다.
즉, 서버는 이전 요청을 기억하지 않고 모든 요청은 완전히 독립적으로 처리된다</p>
<blockquote>
<p>서버 입장에서는 &quot;이 요청을 보낸 사용자가 방금 로그인한 사람인지&quot; 알 방법이 없다❗️</p>
</blockquote>
<p>그래서 등장한 개념이 바로 _사용자를 어떻게 기억할 것인가_이고, 그 해답이 <strong>세션(Session)과 토큰(token)</strong>이다.</p>
<hr />
<h2 id="쿠키는-기억을-전달하는-수단이다">쿠키는 '기억을 전달하는 수단'이다</h2>
<blockquote>
<p>쿠키 자체가 인증 방식은 아니다.</p>
</blockquote>
<p>이 포인트를 잘 기억해야 한다. 쿠키는 단지 <code>서버가 브라우저에 데이터를 저장</code>하게 하고, 이후 <code>요청마다 그 데이터를 자동으로 전달해주는 수단</code>이다. </p>
<p>이 쿠키를 이용해</p>
<ul>
<li>서버가 직접 사용자를 기억하면 -&gt; 세션(Session)</li>
<li>서버가 기억하지 않으면 -&gt; 토큰(Token)</li>
</ul>
<p>이렇게 방식이 나뉜다.</p>
<hr />
<h1 id="사용자를-기억하는-방법-①세션session">사용자를 기억하는 방법 ①세션(Session)</h1>
<p>세션 방식은 <strong>서버가 사용자의 상태를 직접 기억하는 방식</strong>이다.</p>
<h3 id="세션-로그인-흐름">세션 로그인 흐름</h3>
<ol>
<li>사용자가 아이디/비밀번호로 로그인 요청</li>
<li>서버가 인증에 성공하면 <code>Session ID</code> 생성</li>
<li>서버는<ul>
<li><code>Session DB</code>에 <code>Session ID &lt;-&gt; 사용자 정보</code> 저장</li>
<li><code>Session ID</code>를 <strong>쿠키에 담아 브라우저로 전달</strong></li>
</ul>
</li>
<li>이후 요청마다 브라우저는 쿠키(Session ID)를 자동 전송</li>
<li>서버는 Session ID로 DB를 조회해 사용자 확인</li>
</ol>
<blockquote>
<p>즉, 중요한 정보는 전부 서버에 있고, 브라우저는 <code>Session ID</code>만 들고 다닌다</p>
</blockquote>
<h2 id="세션-방식의-특징">세션 방식의 특징</h2>
<ul>
<li>서버가 로그인한 사용자의 상태를 모두 관리</li>
<li>특정 사용자 세션을 삭제해 강제 로그아웃 가능</li>
<li>인증 상태를 서버가 즉시 제어 가능</li>
</ul>
<p>🙋‍♀️ 그래서 계정 정지, 강제 로그아웃, 특정 사용자 차단 같은 기능이 중요한 서비스에 적합하다! 그냥 Session을 삭제해버리면 되기 때문이다...</p>
<h2 id="세션-방식의-한계">세션 방식의 한계</h2>
<ul>
<li>로그인한 사용자 수만큼 서버 자원을 사용해야 함</li>
<li>트래픽 증가 시 Session DB 부하</li>
<li>서버 확장 시 세션 공유 문제 발생</li>
</ul>
<p>그래서 실제 서비스에서는 세션 정보를 <code>Redis</code> 같은 *<code>인메모리DB</code>로 분리하여 관리하기도 한다.</p>
<p><span style="color: grey;"> * 인메모리 DB란 데이터를 디스크가 아닌 주기억장치(RAM)에 저장하는 데이터베이스임</span></p>
<h3 id="쿠키가-없는-환경에서는">쿠키가 없는 환경에서는?</h3>
<p>세션 방식은 쿠키에 의존한다.
하지만 모바일 앱(IOS/Android) 같은 네이티브 환경에서는 쿠키 사용이 제한적이다.</p>
<p>이때 자연스럽게 등장하는 방식이 <strong><code>토큰(Token)</code></strong> 기반 인증이다.</p>
<hr />
<h1 id="사용자를-기억하는-방법-②토큰token">사용자를 기억하는 방법 ②토큰(Token)</h1>
<p>토큰은 <strong>서버가 발급한 임의의 String</strong>이다.</p>
<p>세션과 달리, 서버가 사용자 상태를 직접 저장하지 않고 <strong>토큰 자체를 인증 수단</strong>으로 사용한다.</p>
<h3 id="토큰기반-인증-흐름">토큰기반 인증 흐름</h3>
<ol>
<li>사용자가 로그인</li>
<li>서버가 토큰 발급</li>
<li>클라이언트가 토큰 저장 (쿠키, localStorage 등)</li>
<li>이후 요청마다 토큰을 함께 전송</li>
<li>서버는 토큰을 검증하고 요청 처리</li>
</ol>
<p>이 방식에서는 서버가 &quot;이 사용자가 누구인지&quot;를 기억하지 않는다.</p>
<h2 id="jwtjson-web-token는-왜-등장했을까">JWT(JSON Web Token)는 왜 등장했을까?</h2>
<p>JWT는 토큰의 한 종류로, 차이점은 <strong>토큰 안에 사용자 정보가 들어있다</strong>는 점이다.
JWT에는 보통 <code>사용자 ID</code>, <code>만료 시간</code>, <code>권한 정보</code>와 같은 정보가 들어 있고, 서명을 통해 위변조 여부를 검증한다.</p>
<h2 id="jwt의-특징">JWT의 특징</h2>
<ul>
<li>서버는 DB 조회 없이(!!) 토큰 검증만으로 인증 가능</li>
<li>서버가 사용자 상태를 저장하지 않아도 됨</li>
<li>완전히 <strong>stateless</strong>한 인증 구조</li>
</ul>
<p>그래서 서버 확장이 쉽고, 대규모 트래픽 환경에 유리하다는 장점이 있다.</p>
<h2 id="jwt의-한계">JWT의 한계</h2>
<p>그렇다면 JWT가 좋기만 한가?? 그건 아니다. 다음과 같은 한계를 가진다.</p>
<ul>
<li>토큰이 유출될 경우 만료전까지 탈취한 사람(?)이 사용 가능</li>
<li>특정 사용자를 즉시 로그아웃 시키는 등의 추가 기능 사용이 어려움</li>
<li>토큰 길이가 너무 김</li>
</ul>
<p>그래서 실무에서는 짧은 만료시간의 <code>AccessToken</code>, 긴 만료시간의 <code>RefreshToken</code>을 함께 사용하는 구조가 많다.
<del>내가 했던 모든 프로젝트에서도 대부분 이런 구조였음</del></p>
<hr />
<h3 id="다시-정리해보면">다시 정리해보면</h3>
<ul>
<li>쿠키(Cookie): 데이터를 저장하고 자동으로 전송하는 수단, 매개체 정도</li>
<li>세션(Session): 쿠키(SessionID)를 이용해 서버가 사용자를 기억</li>
<li>토큰(Token): 서버가 발급한 인증용 문자열(String)</li>
<li>JWT: 사용자 정보를 포함한 토큰(DB 조회 없이 인증 가능함)<blockquote>
<p>쿠키 -&gt; &quot;어떻게 전달할까&quot;
세션/토큰 -&gt; &quot;무엇을 기억할까&quot;</p>
</blockquote>
</li>
</ul>
<p>정도로 아<del>~</del>주 간단하게 정리할 수 있을 것 같다. 
쿠키를 단순히 &quot;브라우저 저장소&quot;로만 이해하면 세션과 토큰 구조가 계속 헷갈린다 💦</p>
<p>공부하다보니 HttpOnly, Secure, SameSite 등등.. 더 공부해야 할 게 늘어났지만 정리하고 나니 현재 내가 진행하고 있는 서버의 흐름을 이해하기가 훨씬 명확해진 것 같다..</p>
<p>다음 글은 더 공부하고 또 정리해야것다</p>
<p>.
.
.
.
.
Thanks to 노마드코더, chatGPT</p>